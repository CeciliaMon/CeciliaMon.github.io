<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
  <link href="css/style.css" rel="stylesheet">
  <title>Formulario de Registro</title>

  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-BNMXGVYV0V"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-BNMXGVYV0V');
</script>
</head>

<body>
  <!--Navbar-->
  <nav class="navbar bg-dark navbar-expand-lg border-body z-3" data-bs-theme="dark">
    <div class="container-fluid">
      <a class="navbar-brand" href="#"><img src="img/teatro.logo.jpg" class="img-logo d-inline-block align-text-center" width="60px" alt="logo"> Teatro StarLight</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarText"
        aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarText">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item">
            <a class="nav-link" aria-current="page" href="index.html">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" aria-current="page" href="salas.html">Salas</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" aria-current="page" href="cartelera.html">Cartelera</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" aria-current="page" href="sobre_nosotros.html">Sobre Nosotros</a>
          </li>
        </ul>
        <span class="navbar-text">
          <a type="button" class="btn btn-danger" href="registro_usuario.html">Registrarse</a>
          <a type="button" class="btn btn-secondary" href="inicio_sesion.html">Iniciar Sesion</a>
        </span>
      </div>
    </div>
  </nav>

  <div class="register-form shadow-sm">
    <h2 text-white>Formulario de Registro</h2>

    <form>
      <div class="mb-3">
        <label for="nombre" class="form-label">Nombre</label>
        <input type="text" class="form-control" id="nombre" placeholder="Ingresa tu nombre">
      </div>

      <div class="mb-3">
        <label for="apellido" class="form-label">Apellido</label>
        <input type="text" class="form-control" id="apellido" placeholder="Ingresa tu apellido">
      </div>

      <div class="row g-3">
        <div class="col-md-6">
          <label for="usuario" class="form-label">Nombre de Usuario</label>
          <input type="text" class="form-control" id="usuario" placeholder="Tu nombre de usuario">
        </div>
        <div class="col-md-6">
          <label for="password" class="form-label">Contraseña</label>
          <div class="input-group">
            <input type="password" class="form-control" id="password" placeholder="••••••••" minlength="8">
            <button class="btn btn-outline-secondary" type="button" id="togglePassword">
              <i class="bi bi-eye-fill text-white"></i>
            </button>
          </div>
          <div class="form-text text-white">Mínimo de 8 caracteres</div>
        </div>
      </div>

      <div class="row g-3 mt-2">
        <div class="col-md-6">
          <label for="email" class="form-label">Email</label>
          <div class="input-group">
            <span class="input-group-text"><i class="bi bi-envelope"></i></span>
            <input type="email" class="form-control" id="email" placeholder="mail@example.com">
          </div>
        </div>
        <div class="col-md-6">
          <label for="telefono" class="form-label">Teléfono</label>
          <input type="tel" class="form-control" id="telefono" placeholder="+34 600 000 000">
        </div>
      </div>

      <div class="text-center mt-4">
        <button type="submit" class="btn btn-danger px-5" id="liveToastBtn">Registrarse</button>
      </div>
    </form>
  </div>
  <div class="toast-container position-fixed bottom-0 end-0 p-3">
    <div id="liveToast" class="toast text-bg-dark" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="toast-header">
        <img src="img/teatro.logo.jpg" class="rounded me-2" alt="..." width="20px">
        <strong class="me-auto">Teatro StarLight</strong>
        <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
      <div class="toast-body">
        Compra Confirmada con Éxito!
      </div>
    </div>
  </div>

  <footer class="site-footer-minimal">
    <div class="footer-container-minimal">
        
        <div class="social-icons-minimal">
            <a href="#" aria-label="Síguenos en Facebook"><span class="icon-facebook-min"></span></a>
            <a href="#" aria-label="Síguenos en Instagram"><span class="icon-instagram-min"></span></a>
            <a href="#" aria-label="Síguenos en X (Twitter)"><span class="icon-twitter-min"></span></a>
        </div>

        <p class="copyright-minimal">
            @Copyright Todos los derechos reservados - Teatro StarLight
        </p>

    </div>
</footer>

  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
    integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
    crossorigin="anonymous"></script>

  <script>
    function showToast(title, body, isSuccess = true) {
        // Usamos la ID "liveToast" que tienes en el HTML
        const toastLiveExample = document.getElementById('liveToast'); 
        if (!toastLiveExample) return; 

        const toastBootstrap = bootstrap.Toast.getOrCreateInstance(toastLiveExample);

        // 1. Configurar el contenido del Toast
        toastLiveExample.querySelector('.me-auto').textContent = title;
        toastLiveExample.querySelector('.toast-body').textContent = body;

        // Opcional: Cambiar la clase del header para un color de éxito/error (usando BG)
        const toastHeader = toastLiveExample.querySelector('.toast-header');
        toastHeader.classList.remove('bg-success', 'bg-danger', 'text-white'); // Limpiar
        
        // El Toast tiene clase text-bg-dark, por lo que quizás no necesites text-white aquí, 
        // pero lo mantenemos para consistencia si cambias el fondo.
        if (isSuccess) {
            toastHeader.classList.add('bg-success', 'text-white');
        } else {
            toastHeader.classList.add('bg-danger', 'text-white');
        }

        // 2. Mostrar el Toast
        toastBootstrap.show();
    }
    
    // Referencias a elementos del formulario
    const registerForm = document.querySelector(".register-form form");
    const passwordInput = document.querySelector("#password");
    const togglePassword = document.querySelector("#togglePassword");
    const toggleIcon = togglePassword.querySelector("i");

    // 1. Funcionalidad de Mostrar/Ocultar Contraseña
    togglePassword.addEventListener("click", () => {
        const type = passwordInput.getAttribute("type") === "password" ? "text" : "password";
        passwordInput.setAttribute("type", type);
        toggleIcon.className = type === "password" ? 'bi bi-eye-fill' : 'bi bi-eye-slash-fill';
    });

    // 2. Funcionalidad de Registro (Manejo del Envío del Formulario)
    registerForm.addEventListener('submit', function (event) {
        event.preventDefault();

        // Obtener valores y limpiar espacios en blanco
        const nombre = document.getElementById('nombre').value.trim();
        const apellido = document.getElementById('apellido').value.trim();
        const usuario = document.getElementById('usuario').value.trim();
        const email = document.getElementById('email').value.trim();
        const password = passwordInput.value;
        
        // ------------------------------------------------------------------
        // CORRECCIÓN 1: Mover la definición de newUser al principio
        // ------------------------------------------------------------------
        const newUser = {
            usuario: usuario,
            password: password,
            nombre: nombre,
            apellido: apellido,
            email: email
        };

        // Validación (USANDO TOAST)
        if (!nombre || !apellido || !usuario || !email || password.length < 8) {
            showToast('Error de Validación', 'Por favor, completa todos los campos. La contraseña debe tener al menos 8 caracteres.', false);
            return;
        }

        // Almacenamiento en localStorage
        let users = JSON.parse(localStorage.getItem('users')) || [];

        // Verificar si el usuario o email ya existe (AHORA newUser está definido)
        const userExists = users.some(user => user.usuario === newUser.usuario || user.email === newUser.email);
        if (userExists) {
            showToast('Error de Registro', 'El nombre de usuario o el email ya están registrados.', false);
            return;
        }
        
        // Guardar
        users.push(newUser);
        localStorage.setItem('users', JSON.stringify(users));

        // Notificación de éxito
        showToast('Éxito', '¡Registro exitoso! Serás redirigido para iniciar sesión.', true);

        // Redirige a la página de inicio de sesión después de un pequeño retraso
        setTimeout(() => {
            window.location.href = 'inicio_sesion.html';
        }, 1000); // 1.5 segundos de retraso para que el usuario vea el Toast.
    });
    
    // function updateNavbarAuth() { /* ... */ }
  </script>

</body>

</html>